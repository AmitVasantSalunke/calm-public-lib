{
    "tasks":[
        {
            "uid":"56fa253ca5979a080c3627c6",
            "classification":"provision_aws_ec2",
            "creation_time":1458300105,
            "user_data":null,
            "credential_id":"56fa253ca5979a080c3627c1",
            "keypair":"sarath",
            "security_groups":[
                {
                    "vpc_id":"vpc-b52286d0",
                    "uuid":"sg-06fb6e7e",
                    "uid":"sg-06fb6e7e",
                    "classification":null,
                    "name":"Flocker"
                }
            ],
            "subnet":"subnet-575eb80e",
            "network":"vpc-b52286d0",
            "zone":"us-east-1",
            "ami_name":null,
            "storage":{
                "Root":{
                    "Device":"\/dev\/sda1",
                    "delete_on_termination":true,
                    "volume_type":"standard",
                    "Size":40
                },
                "EBS":[

                ]
            },
            "variable_cost":0.0,
            "version":34,
            "editables":[

            ],
            "iam_role":null,
            "ami":"ami-f3929299",
            "tags":{
                "Team":"DevOps"
            },
            "fixed_cost":null,
            "modification_time":1459335736,
            "public_ip":true,
            "shutdown_behavior":"terminate",
            "name":"Provision AWS EC2",
            "instance_name":"DockerSwarnNode",
            "instance_type":"t2.medium"
        },
        {
            "uid":"56fa253ca5979a080c3627c7",
            "classification":"runshell",
            "script":"#!\/bin\/bash\nset -ex\nsudo apt-get update\nnode_count=@@{AGENT_NODES}@@\necho \"DOCKER_OPTS='--cluster-store=consul:\/\/$(\/usr\/bin\/ec2metadata --local-ipv4):8500 --cluster-advertise=eth0:2375 -H unix:\/\/\/var\/run\/docker.sock -H=0.0.0.0:2375'\" | sudo tee \/etc\/default\/docker\nsudo rm -f \/etc\/docker\/key.json\nsudo usermod -aG docker $(id -nu)\nsudo service docker restart\nsleep 10\nsudo docker pull swarm:1.0.1\nsudo docker run -d -p 8300:8300 -p 8301:8301 -p 8301:8301\/udp -p 8302:8302 -p 8302:8302\/udp -p 8400:8400 -p 8500:8500 progrium\/consul -server -advertise $(\/usr\/bin\/ec2metadata --local-ipv4) -bootstrap-expect ${node_count}\nsudo docker run -d -p 2376:2376  swarm manage -H :2376 --replication --advertise $(\/usr\/bin\/ec2metadata --public-ipv4):2376 consul:\/\/$(\/usr\/bin\/ec2metadata --local-ipv4):8500\n",
            "creation_time":1458300131,
            "credential_id":"56fa253ca5979a080c3627c1",
            "modification_time":1459335736,
            "version":33,
            "editables":[

            ],
            "name":"InstallDockerSwarm"
        },
        {
            "uid":"56fa253ca5979a080c3627c8",
            "classification":"provision_aws_ec2",
            "creation_time":1458301032,
            "user_data":null,
            "credential_id":"56fa253ca5979a080c3627c1",
            "keypair":"sarath",
            "security_groups":[
                {
                    "vpc_id":"vpc-b52286d0",
                    "uuid":"sg-06fb6e7e",
                    "uid":"sg-06fb6e7e",
                    "classification":null,
                    "name":"Flocker"
                }
            ],
            "subnet":"subnet-575eb80e",
            "network":"vpc-b52286d0",
            "zone":"us-east-1",
            "ami_name":null,
            "storage":{
                "Root":{
                    "Device":"\/dev\/sda1",
                    "delete_on_termination":true,
                    "volume_type":"standard",
                    "Size":40
                },
                "EBS":[

                ]
            },
            "variable_cost":0.0,
            "version":28,
            "editables":[

            ],
            "iam_role":null,
            "ami":"ami-f3929299",
            "tags":{
                "Team":"DevOps"
            },
            "fixed_cost":null,
            "modification_time":1459335736,
            "public_ip":true,
            "shutdown_behavior":"terminate",
            "name":"Provision AWS EC2",
            "instance_name":"DockerSwarnNode@@{calm_array_index}@@",
            "instance_type":"t2.medium"
        },
        {
            "uid":"56fa253ca5979a080c3627c9",
            "classification":"runshell",
            "script":"#!\/bin\/bash\nset -ex\nsudo apt-get update\nconsul_master_ip=@@{CONSULIP}@@\necho \"DOCKER_OPTS='--cluster-store=consul:\/\/$(\/usr\/bin\/ec2metadata --local-ipv4):8500 --cluster-advertise=eth0:2375 -H unix:\/\/\/var\/run\/docker.sock -H=0.0.0.0:2375'\" | sudo tee \/etc\/default\/docker\nsudo rm -f \/etc\/docker\/key.json\nsudo usermod -aG docker $(id -nu)\nsudo service docker restart\nsleep 10\nsudo docker pull swarm:1.0.1\nsudo docker run -d -p 8300:8300 -p 8301:8301 -p 8301:8301\/udp -p 8302:8302 -p 8302:8302\/udp -p 8400:8400 -p 8500:8500 progrium\/consul -server -advertise $(\/usr\/bin\/ec2metadata --local-ipv4) -join ${consul_master_ip}\nsudo docker run -d -p 2376:2376 swarm manage -H :2376 --replication --advertise $(\/usr\/bin\/ec2metadata --public-ipv4):2376 consul:\/\/$(\/usr\/bin\/ec2metadata --local-ipv4):8500\nsudo docker run -d  swarm join --addr=$(\/usr\/bin\/ec2metadata --public-ipv4):2375 consul:\/\/$(\/usr\/bin\/ec2metadata --local-ipv4):8500\n",
            "creation_time":1458301128,
            "credential_id":"56fa253ca5979a080c3627c1",
            "modification_time":1459335736,
            "version":25,
            "editables":[

            ],
            "name":"InstallDockerSwarm"
        }
    ],
    "uid":"56fa253ca5979a080c3627bf",
    "classification":"blueprint",
    "autoscale_config":{
        "post_flow":null,
        "cool_down_period":"1800",
        "uid":"56ebe4c9a5979a0829be5505",
        "classification":null,
        "alert_count":"1",
        "max_count":"1",
        "pre_flow":null,
        "min_count":"1",
        "listen_for":"external",
        "scale_by":"1",
        "alert_window":"1800"
    },
    "cost":0.0,
    "strategy_enabled":false,
    "environment":"default",
    "provider":null,
    "config":{
        "setup":[

        ],
        "uid":"56ebe4c9a5979a0829be5506",
        "classification":null,
        "deploy":[

        ]
    },
    "calm-version":"1.7.0",
    "description":null,
    "parent":null,
    "flows":[

    ],
    "dependencies":[

    ],
    "credentials":[
        {
            "username":"ubuntu",
            "public_key":null,
            "uid":"56fa253ca5979a080c3627c1",
            "classification":null,
            "secret_type":"ssh_key",
            "creation_time":1458300105,
            "modification_time":1459335736,
            "secret":null,
            "version":34,
            "name":"Demo"
        }
    ],
    "bp_id":null,
    "properties":[
        {
            "uid":"56ebe814a5979a0824b25529",
            "classification":null,
            "editable":false,
            "value":"2",
            "key":"AGENT_NODES",
            "property_description":null,
            "property_type":"EXTERNAL",
            "setter":null
        }
    ],
    "autoscale_enabled":false,
    "name":"DockerSwarmHANoTls",
    "setup_ids":{

    },
    "h":0.0,
    "resiliency_config":{
        "post_flow":null,
        "cool_down_period":"1800",
        "alert_window":"1800",
        "classification":null,
        "alert_count":"1",
        "pre_flow":null,
        "listen_for":"internal",
        "uid":"56ebe4c9a5979a0829be5507"
    },
    "resiliency_enabled":false,
    "architecture":[
        {
            "tasks":[

            ],
            "uid":"cid:00000001",
            "classification":"compute",
            "address":"@@{public_ip_address}@@",
            "credential_id":null,
            "autoscale_config":{
                "post_flow":null,
                "cool_down_period":"1800",
                "uid":"56ebe868a5979a0829be56a2",
                "classification":null,
                "alert_count":"1",
                "max_count":"1",
                "pre_flow":null,
                "min_count":"1",
                "listen_for":"external",
                "scale_by":"1",
                "alert_window":"1800"
            },
            "cost":0.0,
            "strategy_enabled":false,
            "provider":"56fa253ca5979a080c3627c8",
            "service_type":"ssh",
            "config":{
                "setup":[

                ],
                "uid":"56ebe868a5979a0829be56a5",
                "classification":null,
                "deploy":[
                    "56fa253ca5979a080c3627c9"
                ]
            },
            "parent":"56fa253ca5979a080c3627ca",
            "array_data":{
                "tasks":[

                ],
                "uid":"56fa253ca5979a080c3627cb",
                "classification":"array",
                "creation_time":1458301032,
                "policy_rules":[

                ],
                "autoscale_config":{
                    "post_flow":null,
                    "cool_down_period":"1800",
                    "uid":"56ebe868a5979a0829be569d",
                    "classification":null,
                    "alert_count":"1",
                    "max_count":"1",
                    "pre_flow":null,
                    "min_count":"1",
                    "listen_for":"external",
                    "scale_by":"1",
                    "alert_window":"1800"
                },
                "cost":0.0,
                "strategy_enabled":false,
                "version":29,
                "scale_down_task":null,
                "provider":null,
                "config":{
                    "scale_up":[

                    ],
                    "scale_down":[

                    ],
                    "uid":"56ebe868a5979a0829be56a0",
                    "classification":null
                },
                "parent":"56fa253ca5979a080c3627bf",
                "scale_up_task":null,
                "flows":[

                ],
                "modification_time":1459335736,
                "bp_id":"56fa253ca5979a080c3627bf",
                "properties":[

                ],
                "count":"@@{AGENT_NODES}@@",
                "autoscale_enabled":false,
                "name":"SwarmArray (Array)",
                "h":0.0,
                "resiliency_config":{
                    "post_flow":null,
                    "cool_down_period":"1800",
                    "alert_window":"1800",
                    "classification":null,
                    "alert_count":"1",
                    "pre_flow":null,
                    "listen_for":"internal",
                    "uid":"56ebe868a5979a0829be569e"
                },
                "resiliency_enabled":false,
                "w":0.0,
                "strategy_config":{
                    "post_flow":null,
                    "rollback_pre_flow":null,
                    "classification":null,
                    "rolling_factor":"100",
                    "initial_version":null,
                    "approval_flag":false,
                    "upgrade_flow":null,
                    "rollback_flow":null,
                    "pre_flow":null,
                    "rollback_post_flow":null,
                    "upgrade_type":"rolling_upgrade",
                    "uid":"56ebe868a5979a0829be569f",
                    "users":[

                    ],
                    "teams":[

                    ],
                    "emails":[

                    ],
                    "initial_count":"1"
                },
                "y":0.0,
                "x":0.0
            },
            "flows":[

            ],
            "dependencies":[
                {
                    "key":"CONSULIP",
                    "uid":"56ebe961a5979a0829be5966",
                    "classification":null,
                    "setter":{
                        "source_id":"cid:00000002",
                        "prop_id":"56ebe952a5979a0829be58e8",
                        "uid":"56ebe961a5979a0829be598e",
                        "classification":null
                    }
                }
            ],
            "service_port":22,
            "bp_id":"56fa253ca5979a080c3627bf",
            "properties":[

            ],
            "autoscale_enabled":false,
            "name":"SwarmArray",
            "h":0.0,
            "resiliency_config":{
                "post_flow":null,
                "cool_down_period":"1800",
                "alert_window":"1800",
                "classification":null,
                "alert_count":"1",
                "pre_flow":null,
                "listen_for":"internal",
                "uid":"56ebe868a5979a0829be56a3"
            },
            "resiliency_enabled":false,
            "w":0.0,
            "strategy_config":{
                "post_flow":null,
                "rollback_pre_flow":null,
                "classification":null,
                "rolling_factor":"100",
                "initial_version":null,
                "approval_flag":false,
                "upgrade_flow":null,
                "rollback_flow":null,
                "pre_flow":null,
                "rollback_post_flow":null,
                "upgrade_type":"rolling_upgrade",
                "uid":"56ebe868a5979a0829be56a4",
                "users":[

                ],
                "teams":[

                ],
                "emails":[

                ],
                "initial_count":"1"
            },
            "y":280.0,
            "x":124.5,
            "os_type":"Linux"
        },
        {
            "tasks":[

            ],
            "uid":"cid:00000002",
            "classification":"compute",
            "address":"@@{public_ip_address}@@",
            "credential_id":null,
            "autoscale_config":{
                "post_flow":null,
                "cool_down_period":"1800",
                "uid":"56ebe4c9a5979a0829be54fa",
                "classification":null,
                "alert_count":"1",
                "max_count":"1",
                "pre_flow":null,
                "min_count":"1",
                "listen_for":"external",
                "scale_by":"1",
                "alert_window":"1800"
            },
            "cost":0.0,
            "strategy_enabled":false,
            "provider":"56fa253ca5979a080c3627c6",
            "service_type":"ssh",
            "config":{
                "setup":[

                ],
                "uid":"56ebe4c9a5979a0829be54fd",
                "classification":null,
                "deploy":[
                    "56fa253ca5979a080c3627c7"
                ]
            },
            "parent":"56fa253ca5979a080c3627bf",
            "flows":[

            ],
            "dependencies":[

            ],
            "service_port":22,
            "bp_id":"56fa253ca5979a080c3627bf",
            "properties":[
                {
                    "uid":"56ebe952a5979a0829be58e8",
                    "classification":null,
                    "editable":false,
                    "value":null,
                    "key":"IP",
                    "property_description":null,
                    "property_type":"EXTERNAL",
                    "setter":{
                        "source_id":"56fa253ca5979a080c3627c6",
                        "uid":"56ebe952a5979a0829be591b",
                        "classification":null,
                        "prop":"private_ip_address"
                    }
                }
            ],
            "autoscale_enabled":false,
            "name":"Node0",
            "h":0.0,
            "resiliency_config":{
                "post_flow":null,
                "cool_down_period":"1800",
                "alert_window":"1800",
                "classification":null,
                "alert_count":"1",
                "pre_flow":null,
                "listen_for":"internal",
                "uid":"56ebe4c9a5979a0829be54fb"
            },
            "resiliency_enabled":false,
            "w":0.0,
            "strategy_config":{
                "post_flow":null,
                "rollback_pre_flow":null,
                "classification":null,
                "rolling_factor":"100",
                "initial_version":null,
                "approval_flag":false,
                "upgrade_flow":null,
                "rollback_flow":null,
                "pre_flow":null,
                "rollback_post_flow":null,
                "upgrade_type":"rolling_upgrade",
                "uid":"56ebe4c9a5979a0829be54fc",
                "users":[

                ],
                "teams":[

                ],
                "emails":[

                ],
                "initial_count":"1"
            },
            "y":100.0,
            "x":50.0,
            "os_type":"Linux"
        }
    ],
    "w":0.0,
    "strategy_config":{
        "post_flow":null,
        "rollback_pre_flow":null,
        "classification":null,
        "rolling_factor":"100",
        "initial_version":null,
        "approval_flag":false,
        "upgrade_flow":null,
        "rollback_flow":null,
        "pre_flow":null,
        "rollback_post_flow":null,
        "upgrade_type":"rolling_upgrade",
        "uid":"56ebe4c9a5979a0829be5508",
        "users":[

        ],
        "teams":[

        ],
        "emails":[

        ],
        "initial_count":"1"
    },
    "y":0.0,
    "x":0.0
}